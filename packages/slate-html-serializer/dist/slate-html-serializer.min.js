!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("react-dom/server"),require("type-of"),require("slate"),require("immutable")):"function"==typeof define&&define.amd?define(["exports","react","react-dom/server","type-of","slate","immutable"],r):r(e.SlateHtmlSerializer={},e.React,e.ReactDOMServer,e.typeOf,e.Slate,e.Immutable)}(this,function(e,r,t,n,a,i){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n;var o=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},l=new i.Record({object:"string",text:""}),u={deserialize:function(e){if(e.tagName&&"br"===e.tagName.toLowerCase())return{object:"text",leaves:[{object:"leaf",text:"\n"}]};if("#text"==e.nodeName){if(e.nodeValue&&e.nodeValue.match(/<!--.*?-->/))return;return{object:"text",leaves:[{object:"leaf",text:e.nodeValue}]}}},serialize:function(e,t){if("string"===e.object)return t.split("\n").reduce(function(e,t,n){return 0!=n&&e.push(r.createElement("br",{key:n})),e.push(t),e},[])}};function s(e){if("undefined"==typeof DOMParser)throw new Error("The native `DOMParser` global which the `Html` serializer uses by default is not present in this environment. You must supply the `options.parseHtml` function instead.");return(new DOMParser).parseFromString(e,"text/html").body||window.document.createElement("body")}var c=function(){var e=this;this.deserialize=function(r){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).toJSON,n=void 0!==t&&t,i=e.defaultBlock,l=(0,e.parseHtml)(r),u=Array.from(l.childNodes),s=e.deserializeElements(u);0==(s=s.reduce(function(e,r,t,n){if("block"==r.object)return e.push(r),e;if(t>0&&"block"!=n[t-1].object)return e[e.length-1].nodes.push(r),e;var a=o({object:"block",data:{}},i,{nodes:[r]});return e.push(a),e},[])).length&&(s=[o({object:"block",data:{}},i,{nodes:[{object:"text",leaves:[{object:"leaf",text:"",marks:[]}]}]})]);var c={object:"value",document:{object:"document",data:{},nodes:s}};return n?c:a.Value.fromJSON(c)},this.deserializeElements=function(){var r=[];return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter(e.cruftNewline).forEach(function(t){var a=e.deserializeElement(t);switch(n(a)){case"array":r=r.concat(a);break;case"object":r.push(a)}}),r},this.deserializeElement=function(r){var t=void 0;r.tagName||(r.tagName="");var a=function(r){switch("[object NodeList]"==Object.prototype.toString.call(r)&&(r=Array.from(r)),n(r)){case"array":return e.deserializeElements(r);case"object":return e.deserializeElement(r);case"null":case"undefined":return;default:throw new Error('The `next` argument was called with invalid children: "'+r+'".')}},i=!0,o=!1,l=void 0;try{for(var u,s=e.rules[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value;if(c.deserialize){var f=c.deserialize(r,a),d=n(f);if("array"!=d&&"object"!=d&&"null"!=d&&"undefined"!=d)throw new Error('A rule returned an invalid deserialized representation: "'+t+'".');if(void 0!==f){if(null===f)return null;t="mark"==f.object?e.deserializeMark(f):f;break}}}}catch(e){o=!0,l=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw l}}return t||a(r.childNodes)},this.deserializeMark=function(r){var t=r.type,n=r.data;return r.nodes.reduce(function(r,a){var i=function r(a){return"mark"==a.object?e.deserializeMark(a):("text"==a.object?a.leaves=a.leaves.map(function(e){return e.marks=e.marks||[],e.marks.push({type:t,data:n}),e}):a.nodes&&(a.nodes=a.nodes.map(r)),a)}(a);return Array.isArray(i)?r.concat(i):(r.push(i),r)},[])},this.serialize=function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.document.nodes.map(e.serializeNode).filter(function(e){return e});return!1===a.render?i:t.renderToStaticMarkup(r.createElement("body",null,i)).slice(6,-7)},this.serializeNode=function(r){if("text"===r.object)return r.getLeaves().map(e.serializeLeaf);var t=r.nodes.map(e.serializeNode),n=!0,a=!1,i=void 0;try{for(var o,l=e.rules[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var u=o.value;if(u.serialize){var s=u.serialize(r,t);if(null===s)return;if(s)return d(s)}}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}throw new Error('No serializer defined for node of type "'+r.type+'".')},this.serializeLeaf=function(r){var t=new l({text:r.text}),n=e.serializeString(t);return r.marks.reduce(function(r,t){var n=!0,a=!1,i=void 0;try{for(var o,l=e.rules[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var u=o.value;if(u.serialize){var s=u.serialize(t,r);if(null===s)return;if(s)return d(s)}}}catch(e){a=!0,i=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw i}}throw new Error('No serializer defined for mark of type "'+t.type+'".')},n)},this.serializeString=function(r){var t=!0,n=!1,a=void 0;try{for(var i,o=e.rules[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var l=i.value;if(l.serialize){var u=l.serialize(r,r.text);if(u)return u}}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}},this.cruftNewline=function(e){return!("#text"===e.nodeName&&"\n"==e.nodeValue)}},f=0;function d(e){return r.cloneElement(e,{key:f++})}e.default=function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),c.call(this);var t=r.defaultBlock,n=void 0===t?"paragraph":t,i=r.parseHtml,o=void 0===i?s:i,l=r.rules,f=void 0===l?[]:l;n=a.Node.createProperties(n),this.rules=[].concat(function(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}(f),[u]),this.defaultBlock=n,this.parseHtml=o},Object.defineProperty(e,"__esModule",{value:!0})});
